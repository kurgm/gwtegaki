// @ts-check

import fs from "node:fs/promises";
import path from "node:path";
import { fileURLToPath } from "node:url";

/**
 * @typedef Entry
 * @property {string[]} pathDs
 */

/**
 * @type {Record<string, Entry>}
 */
const entries = {
  u31d5: {
    pathDs: ["M15 27v4h152v-4H15z", "m167 22-6 5v159l12-6V35l5-4-11-9z"],
  },
  u53e3: {
    pathDs: [
      "M36 38v136l12-6V44l-12-6z",
      "M42 44v4h116v-4H42z",
      "m158 39-6 5v124l12-6V52l5-4-11-9z",
      "M42 152v4h116v-4H42z",
    ],
  },
  u961d: {
    pathDs: [
      "M76.400391 26v4h57.199219v-4H76.400391z",
      "m133.59961 21-5.43555 4.529297-.06445-.029297-.04883.123047L127.59961 26v.775391l-1.5 3.824218-2.19922 5.09961-2.40039 5.40039-2.69922 5.5-2.90039 5.59961-3.09961 5.90039-3.30078 6-3.5 6.201172-3.59961 6.398438-3.701171 6.701172L100.19922 84.5 105.5 78.900391l4.90039-5.59961L115 67.699219l4.19922-5.5 3.90039-5.5 3.70117-5.5 3.5-5.298828 3.09961-5.300782 3-5.099609.75586-1.482422L139.59961 33l5-3-11-9z",
      "m100.69922 82.5-.59961 1.599609 10 6.701172L118 97.199219l5.80078 6.601561 4 6.69922 2.5 6.69922 1.19922 6.5.19922 6.30078L131 135.59961 129.69922 140.5l-1.59961 3.80078-.69922 1.29883-.70117 1-.69922.80078-.69922.69922-.80078.5-.80078.5-.89844.30078-1.10156.29883-1.19922.20117-1.30078.09961h-12v3l12 3v6l2.5-.19922 2.40039-.30078 2.40039-.69922 2.30078-.90039 2.09961-1.09961 2-1.5 1.79883-1.60156 1.60156-1.89844 1.39844-2.10156 1.20117-2.19922 1.90039-5.69922 1.19922-6.5.30078-7.30078-.90039-7.69922-2.20117-8-3.79883-7.90039-5.5-7.599609-7.5-6.800781-9.59961-5.800781L100.69922 82.5z",
      "M70.400391 20v169l12-6V26l-12-6z",
    ],
  },
  u5e7a: {
    pathDs: [
      "m94.599609 18.199219-.591797 1.304687L94 19.5l-.050781.130859-.34961.769532.044922.015625-2.24414 5.783203-2.800782 6.5-2.90039 6.40039-3 6.300782-3.199219 6-3.300781 6-3.398438 5.798828-3.5 5.800781-3.5 5.699219-3.5 5.701172L63.599609 81.5l5.09961-4.400391 4.90039-4.90039L78.199219 67 82.5 61.599609l4.199219-5.699218 4-5.900391 3.90039-6.099609L98.199219 37.5l3.500001-6.5 1.625-3.248047L107 27.300781l-1.90039-3.101562-10.500001-6z",
      "m38.300781 63.699219-1 1.5 5.898438 5L48.800781 75l5.398438 4.699219 5 4.601562 4.701172 4.59961L68.300781 93.5l4 4.599609L76 102.69922l3.300781 4.60156 3 4.59961 3.898438 2.40039 4.5-.90039 2.40039-3.90039-.90039-4.40039-3.898438-4.79883-4.201172-4.601561-4.5-4.5-4.90039-4.398438L69.599609 82.5 64 78.400391l-5.800781-4-6.298828-3.800782L45.300781 67l-7-3.300781z",
      "m133.69922 55.099609-.56055 1.119141-.03906-.019531L127 68.800781l-6.5 12.298828L113.69922 93 106.5 104.59961l-7.599609 11.30078-7.900391 11-8.199219 10.69922-8.5 10.40039-8.90039 10.19922-9.09961 10.10156 1.298828 1.29883 10.5-8.69922 10.09961-9.20117 9.601562-9.79883L97 131.59961l8.69922-10.69922 8.40039-11 8.09961-11.499999L129.80078 86.5 137 74.199219l5.04492-9.285157 3.6543-.314453L143.90039 61.5l-10.20117-6.400391z",
      "m156.80078 149.09961-11.90039 1L132.80078 151.5l-12.20117 1.59961-12.5 1.70117-12.699219 1.89844L82.5 158.80078l-13.099609 2.09961-13.300782 2.19922L42.5 165.40039l-13.699219 2.5-2 .40039 4.298828 11.29883 2.59961 2.59961 1.404297-3.48242 9.595703-2.11719 13.40039-2.90039 13.201172-3 13-2.79883L97 165.09961l12.5-2.79883L121.69922 159.5l12.10156-2.80078 11.79883-2.79883 11.5-3.09961-.29883-1.70117z",
      "m134.30078 112.19922-1.40039 1.10156L136.80078 120l3.89844 6.59961 3.70117 6.70117L148 140l3.40039 6.69922 3.19922 6.90039 3 7 2.80078 7 2.5 7.20117 2.40039 7.29883 3.09961 3.40039 4.5.30078 3.40039-3.10156.29883-4.59961-3-7.40039-3.40039-7.29883-3.5-7.09961-3.79883-6.90039-4.09961-6.80078-4.30078-6.5-4.59961-6.40039-4.80078-6.09961-5.19922-5.90039-5.59961-5.5z",
    ],
  },
  "u6c35-j": {
    pathDs: [
      "m84.199219 19.400391-.59961 1.699218 4.701172 2.201172 4.09961 2.298828 3.90039 2.201172L99.699219 30l3.101561 2.199219L105.5 34.300781l2.30078 2.09961 1.89844 2 1.5 2 1.20117 1.798828 4 2.300781 4.40039-1.199219 2.19922-4-1.09961-4.40039-2.5-2.300782L116.59961 30.5l-3-1.900391-3.29883-1.798828-3.70117-1.601562-3.79883-1.5-4.201171-1.298828-4.5-1.09961-4.90039-.90039-5-1z",
      "m63.099609 67.300781-.40039 1.798828 4.601562 2L71.5 73.300781l3.900391 2.09961 3.5 2.199218 3.199218 2.09961 2.800782 2.101562L87.300781 84l2.09961 2.099609L91 88.199219l1.400391 2.101562 4 2.199219 4.400389-1.199219 2.19922-4-1.19922-4.40039-2.601561-2.5-3-2.201172L93 76.099609l-3.400391-1.798828-3.699218-1.601562-4-1.5L77.599609 70l-4.5-1.099609-4.90039-.800782-5.09961-.798828z",
      "M65.099609 132.30078 64.699219 134l7 3 6 3.30078 4.90039 3.59961 4.09961 3.90039L89.900391 152l2.298828 4.69922 1.601562 5 .898438 5.60156.201172 6.29883-.59961 6.80078 1.398438 4.29883 4 2.20117L104 185.5l2.19922-4v-8.09961l-.89844-7.59961-1.90039-7L100.5 152.5l-3.800781-5.5-4.798828-4.69922-5.59961-3.90039L80 135.5l-7.099609-2.09961-7.800782-1.09961z",
      "m135.09961 57.599609-8 15.09961L120 86.400391l-6.40039 12.5L108 110l-4.90039 9.69922L98.800781 128l-3.5 7-3 5.5-2.201172 4.19922L88.5 147.5l10.900391 4.90039.999999-3L102.09961 145l2.30078-5.90039 2.90039-7.19922 3.5-8.70117 4.09961-10.09961 4.69922-11.5 5.30078-12.900391 5.69922-14.5 6.20117-15.898438-1.70117-.701172z",
    ],
  },
  "u31c8-var-002": {
    pathDs: [
      "M30 35v4h60v-4H30z",
      "m90 30-6 5v124l.099609 2.5L84.5 164l.800781 2.40039 1.298828 2.29883 1.59961 2 2 1.60156L92.5 173.59961l2.400391.80078 2.5.40039L100 175h70l3.59961-2.40039L176 169l-2.40039-3.59961L170 163l2-25h-2l-6 25h-64l-1.300781-.09961-.898438-.20117-.601562-.19922-.298828-.09961-.201172-.20117L96.5 162l-.099609-.30078-.201172-.59961L96 160.19922V43l5-4-11-9z",
    ],
  },
};

const MSEC_STILL = 1000;
const MSEC_FRAME = 750;

/**
 * @param {string} name
 * @param {Entry} entry
 * @returns {string}
 */
const generateSVG = (name, entry) => {
  const duration = MSEC_STILL + MSEC_FRAME * entry.pathDs.length;
  return [
    `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">`,
    ...entry.pathDs.flatMap((d, i) => {
      const stillEnd = MSEC_STILL / duration;
      const frameStart = (MSEC_STILL + MSEC_FRAME * i) / duration;
      const frameEnd = (MSEC_STILL + MSEC_FRAME * (i + 1)) / duration;
      return [
        `<path d="${d}">`,
        `<animate dur="${duration}ms" repeatCount="indefinite" fill="freeze" calcMode="discrete" `,
        `attributeName="opacity" `,
        `values="1;0.2;1;0.2" `,
        `keyTimes="0;${+stillEnd.toFixed(3)};${+frameStart.toFixed(
          3
        )};${+frameEnd.toFixed(3)}"/>`,
        `</path>`,
      ];
    }),
    `</svg>`,
  ].join("");
};

const __dirname = path.dirname(fileURLToPath(import.meta.url));
const outDir = path.resolve(__dirname, "src/assets/glyphs");

await fs.mkdir(outDir, { recursive: true });

for (const [name, entry] of Object.entries(entries)) {
  const svg = generateSVG(name, entry);
  const outPath = path.join(outDir, `${name}.svg`);
  await fs.writeFile(outPath, svg, "utf-8");
  console.log(`Wrote ${outPath}`);
}
